<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novel Vault</title>
    <style>
        body { font-family: 'Segoe UI', Merriweather; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f4f9; color: #333; }
        header { text-align: center; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        #controls { display: flex; justify-content: space-between; margin-bottom: 20px; }
        select, button { padding: 10px; cursor: pointer; }
        #content { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-height: 400px; white-space: pre-wrap; }
        .loading { font-style: italic; color: #888; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Inter&family=Roboto+Mono&display=swap" rel="stylesheet">
    
</head>
<body>

<header>
    <h1 id="novel-title">Novel Vault</h1>
    <p id="chapter-label">Pilih Bab</p>
</header>

<div id="controls">
    <select id="chapter-select">
        <option value="">-- Memuat Bab --</option>
    </select>
    <div>
        <button onclick="changeChapter(-1)">Prev</button>
        <button onclick="changeChapter(1)">Next</button>
    </div>
</div>

<div id="content">Silakan pilih bab untuk mulai membaca...</div>

<script>
    // --- KONFIGURASI ---
    const CONFIG = {
        username: "lasus023-jpg",
        repo: "r34d".  //,
       // folder: "novel" // Folder tempat menyimpan subfolder novel
    };

    // Mengambil nama novel dari URL parameter: index.html?novel=Solo-Leveling
    const urlParams = new URLSearchParams(window.location.search);
    const currentNovel = urlParams.get('novel') || "Default-Novel";
    
    const chapterSelect = document.getElementById('chapter-select');
    const contentDiv = document.getElementById('content');
    const titleHeader = document.getElementById('novel-title');

    titleHeader.innerText = currentNovel.replace(/-/g, ' ');

    // 1. Ambil daftar file dari GitHub API
    async function fetchChapters() {
        const url = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.folder}/${currentNovel}`;
        
        try {
            const response = await fetch(url);
            const files = await response.json();
            
            // Filter hanya file .txt dan urutkan berdasarkan nama
            const txtFiles = files
                .filter(file => file.name.endsWith('.txt'))
                .sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'}));

            chapterSelect.innerHTML = '<option value="">Pilih Bab</option>';
            txtFiles.forEach(file => {
                const option = document.createElement('option');
                option.value = file.download_url;
                option.text = file.name.replace('.txt', '').replace(/_/g, ' ');
                chapterSelect.appendChild(option);
            });
        } catch (error) {
            contentDiv.innerText = "Gagal memuat daftar bab. Pastikan struktur folder benar.";
        }
    }

    // 2. Baca isi file .txt
    async function loadChapter(url) {
        if (!url) return;
        contentDiv.innerHTML = "<p class='loading'>Sedang memuat isi bab...</p>";
        
        try {
            const response = await fetch(url);
            const text = await response.text();
            contentDiv.innerText = text;
            window.scrollTo(0, 0);
        } catch (error) {
            contentDiv.innerText = "Gagal memuat isi bab.";
        }
    }

    // Event Listener
    chapterSelect.addEventListener('change', (e) => loadChapter(e.target.value));

    function changeChapter(direction) {
        const currentIndex = chapterSelect.selectedIndex;
        const nextIndex = currentIndex + direction;
        if (nextIndex >= 1 && nextIndex < chapterSelect.options.length) {
            chapterSelect.selectedIndex = nextIndex;
            loadChapter(chapterSelect.value);
        }
    }

    // Inisialisasi
    fetchChapters();
</script>

</body>
</html>
