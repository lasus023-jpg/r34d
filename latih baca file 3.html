<!DOCTYPE html>
<html>
<body>
<div id="txt-files-container"></div>

<script>

async function getGitHubTxtFiles(username, repo, folderPath = 'lasus023-jpg, r34d, novel') {
  try {
    // API untuk mendapatkan konten folder
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${folderPath}`;
    
    const response = await fetch(apiUrl);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const contents = await response.json();
    
    // Filter hanya file .txt
    const txtFiles = contents.filter(item => 
      item.type === 'file' && item.name.endsWith('.txt')
    );
    
    console.log(`Ditemukan ${txtFiles.length} file .txt`);
    
    // Baca isi setiap file .txt
    const fileContents = [];
    
    for (const file of txtFiles) {
      try {
        const fileResponse = await fetch(file.download_url);
        if (fileResponse.ok) {
          const content = await fileResponse.text();
          fileContents.push({
            name: file.name,
            content: content,
            size: content.length,
            url: file.html_url,
            downloadUrl: file.download_url
          });
        }
      } catch (err) {
        console.error(`Gagal membaca ${file.name}:`, err);
      }
    }
    
    return fileContents;
    
  } catch (error) {
    console.error('Error accessing GitHub:', error);
    return [];
  }
}


  // old function 
async function loadTxtFiles(folder = 'novel') {
  try {
    const response = await fetch(`http://localhost:3000/api/txt-files/${folder}`);
    const result = await response.json();
    
    if (result.success) {
      const container = document.getElementById('txt-files-container');
      container.innerHTML = '';
      
      result.files.forEach(file => {
        const div = document.createElement('div');
        div.className = 'txt-file';
        div.innerHTML = `
          <h3>${file.name} (${file.size} karakter)</h3>
          <pre>${file.content.substring(0, 200)}...</pre>
          <hr>
        `;
        container.appendChild(div);
      });
    } else {
      console.error('Error:', result.error);
    }
  } catch (error) {
    console.error('Fetch error ada kesalahan:', error);
  }
}

// Contoh penggunaan
loadTxtFiles('documents');
// atau
loadTxtFiles('novel/files');

const express = require('express');
const fs = require('fs');
const path = require('path');
const app = express();

// Endpoint untuk membaca file txt dalam folder
app.get('/api/txt-files/:folder?', (req, res) => {
  const folder = req.params.folder || 'novel';
  const folderPath = path.join(__dirname, folder);
  
  try {
    // Baca semua file di folder
    const files = fs.readdirSync(folderPath);
    
    // Filter hanya file .txt
    const txtFiles = files.filter(file => file.endsWith('.txt'));
    
    // Baca isi setiap file .txt
    const results = txtFiles.map(file => {
      const content = fs.readFileSync(path.join(folderPath, file), 'utf8');
      return {
        name: file,
        content: content,
        size: content.length
      };
    });
    
    res.json({ success: true, files: results });
  } catch (error) {
    res.status(500).json({ 
      success: false, 
      error: 'Folder tidak ditemukan atau tidak dapat diakses' 
    });
  }
});

app.listen(3000, () => console.log('Server running on port 3000'));
  
</script>
</body>
</html>
